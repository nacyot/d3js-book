데이터 연결
=======

데이터를 연결한다는 것은 데이터를 시각화하기 위해서 텍스트파일이나 데이터베이스에서 데이터를 가지고와서 작업할 수 있도록 한다는 뜻이다. d3는 다양한 형태의 데이터를 가져올 수 있도록 미리 여러가지 함수를 만들어 두었고 가져온 데이터를 활용해서 HTML DOM을 생성한다. 데이터의 양이 얼마나 많은지 또는 얼마나 상세한지에 따라 시각화 결과가 달라진다.

그러면 데이터가 무엇인지 살펴보고 실제로 DOM을 생성해보자.

### 데이터

d3는 다양한 형태의 데이터를 가져올 수 있다고 했는데 예를 들면 숫자의 집합이나 문자열의 집합 또는 객체의 집합을 가져올 수 있고 CSV나 JSON파일을 불러올 수도 있다.

가장 간단한 데이터 타입인 숫자의 집합부터 살펴보자.

var data = [2, 4, 6, 8, 10];

너무 간단한것 같아 조금 복잡한 형태인 이름과 나이로 이루어진 집합을 살펴보자.

var data = [ ["철수", 9], ["영희", 8], ["지혜", 10] ];

위에서 보여준 예는 d3에서 바로 사용할 수 있는 javascript 데이터형으로 별도의 작업이 필요 없다.


이러한 데이터를 CSV로 표현하면 다음과 같다.

name,age
철수,9
영희,8
지혜,10

CSV는 ","(comma)로 구분(separated)된 값(values) 형태로 저장하는 데이터이다.

CSV를 d3에서 사용하기 위해서는 다음과 같이 작성한다.

```
d3.csv("children.csv", function(data) {
    console.log(data);
});
```

`csv`함수는 두개의 인자를 사용하는데 첫번째는 데이터가 저장되어 있는 `파일명`이고 두번째는 불러오는 데이터를 처리하는 `콜백함수`이다. d3는 첫번째 인자값으로 지정된 파일을 불러오고 불러오기가 완료되면 두번째 인자에 지정된 콜백함수를 호출한다. 따라서 위의 예는 children.csv파일을 불러오고 그 파일의 내용을 data라는 인자로 받아서 console에 로그로 출력한다.

실제 결과 화면은 다음과 같다.

![샘플](/path/to/img.jpg "샘플")

샘플을 보면 이름(name)과 나이(age) 속성을 가진 배열을 출력하는 것을 알 수 있다. 단 3줄의 함수로 파일을 불러오고 첫번째 줄을 속성으로 하여 배열로 처리한 것이다.

TSV(텝으로 구분한 데이터)와 JSON 데이터도 비슷한 방식으로 처리할 수 있도록 d3에서 이미 함수를 만들어 두었고 우리는 사용만 하면 된다.


### DOM 만들기

이제 첫번째로 데이터 시각화를 할 차례다.

코드가 생소하고 왜 그렇게 되는지 이해가 안되더라고 일단 하나씩 직접 작성해보고 직접 결과를 확인해보길 바란다. 그리고 나서 작성한 코드에 대한 설명을 보고 조금씩 변경해 본다.

간단한 데이터를 사용한다.

```
var data = [2, 4, 6, 8, 10];
```

이제 data를 이용해서 화면에 글자를 출력해보자.

```
d3.select("body").selectAll("p")
    .data(data)
    .enter()
    .append("p")
    .text("첫번째 예제입니다.");

```

위의 코드를 실행하면 `첫번째 예제입니다.`라는 글자가 다섯번 출력되는 걸 볼 수 있다.

![샘플](/path/to/img.jpg "샘플")

어떻게 된건지 한줄 한줄 살펴보자.

```
d3.select("body")
```

DOM중에 body객체를 찾고 다음에 실행되는 함수를 위한 객체로 설정한다. 

```
.selectAll("p")
```

DOM중에 body하위에 있는 p객체를 선택한다. 현재는 아무것도 선택되지 않을 것이다.

```
.data(data)
```

data를 가져온다. 현재 data는 `[2, 4, 6, 8, 10]`으로 5개의 숫자가 들어있고 앞으로 실행되는 함수를 다섯번 호출할 것이다.

```
.enter()
```

data의 각각의 값을 새로운 DOM으로 만들기 위한 함수다.

```
.append("p")
```

새로운 DOM으로 p객체를 만들어서 붙인다. 이제 앞으로 실행되는 함수는 새로만들어질 p객체에 연결된다.

```
.text("첫번째 예제입니다.");
```

새로 만들어질 p객체에 `첫번째 예제입니다`라는 글자를 입력한다.


이번예제는 실제 데이터를 출력하지 않고 글자를 출력하고 있다. 실제 데이터를 출력하도록 소스를 수정해보자.

```
d3.select("body").selectAll("p")
    .data(data)
    .enter()
    .append("p")
    .text(function(d) { return d; }); // 마지막 줄 수정
```

수정된 코드를 실행해보자.

![샘플](/path/to/img.jpg "샘플")

와우! 마지막 줄만 바꿨을 뿐인데 글자에서 데이터를 출력하게 바뀌었다.

d3는 text함수에 문자열과 함수 두가지 타입을 사용할 수 있다.

첫번째 예제는 `첫번째 예제입니다.`라는 문자열을 사용한 것이고 두번째 예제는 `function(d) { return d; }`라는 함수를 사용한 것이다.

함수의 경우 첫번째 인자(위의 예에서는 `d`)는 data를 의미한다. 우리가 만든 데이터는 총 5개이고 각각 2,4,6,8,10을 인자로 전달하게 된다.

소스를 조금 더 수정해보자.

```
d3.select("body").selectAll("p")
    .data(data)
    .enter()
    .append("p")
    .text(function(d) { return "데이터는 " + d + "입니다"; }); // 마지막 줄 다시 수정
```

다시 수정된 코드를 실행해보자.

![샘플](/path/to/img.jpg "샘플")

데이터에 문자열이 추가된 것을 볼 수 있다. 이렇듯 인자를 자유롭게 활용하여 원하는 값을 출력할 수 있다.